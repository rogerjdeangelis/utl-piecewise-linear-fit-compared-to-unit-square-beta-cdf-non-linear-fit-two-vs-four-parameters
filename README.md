# utl-piecewise-linear-fit-compared-to-unit-square-beta-cdf-non-linear-fit-two-vs-four-parameters
Piecewise linear fit compared to unit square beta cdf non linear fit 2 vs 4 parameters
    %let pgm=utl-piecewise-linear-fit-compared-to-unit-square-beta-cdf-non-linear-fit-two-vs-four-parameters;

    %stop_submission

    Piecewise linear fit compared to unit square beta cdf non linear fit 2 vs 4 parameters

    The data can be fit perfectly. I just wanted to show how close a unit square beta could fit
    with 2 insread of four parameters. Is a dicontinuity in the ist derivative a reasonable
    assumption(thw different slopes at the junction point.

    HIGH RESOLUTION COMPARISON

    png grpph
    https://tinyurl.com/2w48kn3j
    https://github.com/rogerjdeangelis/utl-piecewise-linear-fit-compared-to-unit-square-beta-cdf-non-linear-fit-two-vs-four-parameters/blob/main/pltgpgleg.png

    github
    https://tinyurl.com/3u55azby
    https://github.com/rogerjdeangelis/utl-piecewise-linear-fit-compared-to-unit-square-beta-cdf-non-linear-fit-two-vs-four-parameters

    Stackoverflow
    https://tinyurl.com/mpnwwwmc
    https://stackoverflow.com/questions/29382903/how-to-apply-piecewise-linear-fit-in-python


    RELATED REPOS

    https://tinyurl.com/4e335xb9
    https://github.com/rogerjdeangelis/utl-general-framework-for-fitting-non-linear-equation-with-transcendental-functions-on-a-unit-square/blob/main/pltgrf.pdf

    https://tinyurl.com/yc5euh7k
    https://github.com/rogerjdeangelis/utl-using-beta-cdf-and-pdf-unitsquare-to-fit-non-linear-equations-and-simple-polynomials

    output
    https://tinyurl.com/2vrutwfe
    https://github.com/rogerjdeangelis/utl-using-the-unitsquare-framework-and-cumulative-beta-to-fit-a-non-linear-equation/blob/main/pltgrf.pdf


    /*               _     _
     _ __  _ __ ___ | |__ | | ___ _ __ ___
    | `_ \| `__/ _ \| `_ \| |/ _ \ `_ ` _ \
    | |_) | | | (_) | |_) | |  __/ | | | | |
    | .__/|_|  \___/|_.__/|_|\___|_| |_| |_|
    |_|
    */

    /*******************************************************************************************************************************************/
    /*                                                 |                                      |                                                */
    /*                INPUT                            |        PROCESS                       |                 OUTPUT                         */
    /*         TWO EXCACT LINEAR PIECES                |        ========                      |     REDUCTION FROM 4 to 2 PARAMETERS           */
    /*         ========================                |                                      |     ================================           */
    /*                                                 |                                      |                                                */
    /*                                                 |                                      |                      XORG                      */
    /*                      XS                         | COMPARE BETA MODEL TO OPS MODEL      |        0         5        10        15         */
    /*        0         5        10        15          | (NOTE A PEICEWISE LINEAR CAN FIT     |     ---+---------+---------+---------+---      */
    /* YS  ---+---------+---------+---------+--- YS    | DATA EXACTLY. BUT A TWO PARAMETER    |  Y  | STACKOVERFLOW FIT('s' points)     |      */
    /*     |                                   |       | BETA FIT IS QUITE GOOD)              |     | a = 2                             |      */
    /*     | XS      YS                        |       |                                      | 155 + b = 3                             + 155  */
    /* 155 +                                   + 155   |  MAP TO THE UNITSQUARE               |     | c = 13.89                         |      */
    /*     |  1      5.00                      |       |  FIT YS=CDF('BETA',A,B)              |     | d = -68.3                      r  |      */
    /*     |  2      7.00                   *  |       |                                      |     | y = a*x+b(x<6)c*x+d               |      */
    /*     |  3      9.00                      |       |  MAP TO THE UNIT SQUARE              |     |                              r    |      */
    /*     |  4     11.00                      |       |                                      | 125 + ROGERS FIT                   o s  + 125  */
    /* 125 +  5     13.00                 *    + 125   |   FIT UNIT SQUARE USING PROC NLIN    |     | a = 2.4478                        |      */
    /*     |  6     15.00                      |       |                       Mean           |     | b = 1.3775                 r s    |      */
    /*     |  7     28.92               *      |       |  Source      DF     Square           |     | ys=CDF(BETA,xs,a,b)               |      */
    /*     |  8     42.81                      |       |                                      |     |                          r s      |      */
    /*     |  9     56.70             *        |       |  Model        2     1.8794           |  95 + MSE                               + 95   */
    /*  95 + 10     70.59                      + 95    |  Error       13   0.000440           |     |  ROGER        =0.05838            |      */
    /*     | 11     84.47                      |       |  Uncorrected 15                      |     |  STACKOVERFLOW=13.8    r s        |      */
    /*     | 12     98.36           *          |       |                                      |     |                                   |      */
    /*     | 13    112.25                      |       |  A  1.0000000                        |     |                      o s          |      */
    /*     | 14    126.14         *            |       |  B  0.9454235                        |  65 +                      r            + 65   */
    /*  65 + 15    140.03                      + 65    |                                      |     |                    o s            |      */
    /*     |                    *              |       |  CONVERT BACK ORIGINAL UNITS         |     |                    r              |      */
    /*     |                                   |       |                                      |     |                                   |      */
    /*     |                     pefectly      |       |  MEAN SQUARE ERROR                   |     |                  r s              |      */
    /*     |                  *  linear        |       |                                      |  35 +                                   + 35   */
    /*  35 +                                   + 35    |  MSE UNIT_SQUARE     0.00044         |     |                r s                |      */
    /*     |                *                  |       |  MSE ORIGINAL UNITS  0.05838         |     |              r                    |      */
    /*     |                                   |       |                                      |     |            r o s r=rogers fit     |      */
    /*     | perfectly    *                    |       |  MSE STACKOVERFLOW   13.8            |     |        o r o     s=stackoverflow  |      */
    /*     | linear      *                     |       |                                      |   5 +    r r r         0=observed       +  5   */
    /*   5 +        *                          +  5    |  HIH RESOLUTION GRAPH                |     |                                   |      */
    /*     | *                                 |       |                                      |     ---+---------+---------+---------+---      */
    /*     ---+---------+---------+---------+---       |                                      |        0         5        10        15         */
    /*        0         5        10        15          |                                      |                                                */
    /*                     XS                          |                                      |                     XORG                       */
    /*                                                 |                                      |                                                */
    /*******************************************************************************************************************************************/

    /*                   _
    (_)_ __  _ __  _   _| |_
    | | `_ \| `_ \| | | | __|
    | | | | | |_) | |_| | |_
    |_|_| |_| .__/ \__,_|\__|
            |_|
    */
    options validvarname=upcase;
    libname sd1 "d:/sd1";
    data sd1.have;
      input xs ys stackoverflow;
    cards4;
     1   5.00 5.
     2   7.00 7.
     3   9.00 9.
     4  11.00 11.
     5  13.00 13.
     6  15.00 15.
     7  28.92 17.
     8  42.81 28.92166667
     9  56.70 42.8097619
    10  70.59 56.69785714
    11  84.47 70.58595238
    12  98.36 84.47404762
    13 112.25 98.36214286
    14 126.14 112.2502381
    15 140.03 126.13833333
    ;;;;
    run;quit;

    options ls=64 ps=44;
    proc plot data=sd1.have(rename=ys=y12345678901234567890);
     plot y12345678901234567890*xs='0' stackoverflow*xs='s' /box overlay;
    run;quit;

    /**************************************************************************************************************************/
    /*                                                                                                                        */
    /*        XS      YS      STACKOVERFLOW (FIT fo the initial post not the exact solutions)                                 */
    /*                                                                                                                        */
    /*         1      5.00         5.000                                                                                      */
    /*         2      7.00         7.000                                                                                      */
    /*         3      9.00         9.000                                                                                      */
    /*         4     11.00        11.000                                                                                      */
    /*         5     13.00        13.000                                                                                      */
    /*         6     15.00        15.000                                                                                      */
    /*         7     28.92        17.000                                                                                      */
    /*         8     42.81        28.922                                                                                      */
    /*         9     56.70        42.810                                                                                      */
    /*        10     70.59        56.698                                                                                      */
    /*        11     84.47        70.586                                                                                      */
    /*        12     98.36        84.474                                                                                      */
    /*        13    112.25        98.362                                                                                      */
    /*        14    126.14       112.250                                                                                      */
    /*        15    140.03       126.138                                                                                      */
    /*                                                                                                                        */
    /*                        XS                                                                                              */
    /*           0         5        10        15                                                                              */
    /*        ---+---------+---------+---------+---                                                                           */
    /*        |                                   |                                                                           */
    /*        |  XS    YS   STACKOVERFLOW FIT     |                                                                           */
    /*    155 +                                   + 155                                                                       */
    /*        |   1    5.00   5.000               |                                                                           */
    /*        |   2    7.00   7.000            o  |                                                                           */
    /*        |   3    9.00   9.000               |                                                                           */
    /*        |   4   11.00  11.000               |                                                                           */
    /*    125 +   5   13.00  13.000          o s  + 125                                                                       */
    /*        |   6   15.00  15.000               |                                                                           */
    /*        |   7   28.92  17.000        o s    |                                                                           */
    /*        |   8   42.81  28.922               |                                                                           */
    /*        |   9   56.70  42.810      o s      |                                                                           */
    /*     95 +  1o   70.59  56.698               + 95                                                                        */
    /*        |  11   84.47  70.586               |                                                                           */
    /*        |  12   98.36  84.474    o s        |                                                                           */
    /*        |  13  112.25  98.362               |                                                                           */
    /*        |  14  126.14 112.250  o s          |                                                                           */
    /*     65 +  15  140.03 126.138               + 65                                                                        */
    /*        |                    o s            |                                                                           */
    /*        | s=stackoverflow                   |                                                                           */
    /*        | o=observed                        |                                                                           */
    /*        |                  o s              |                                                                           */
    /*     35 +                                   + 35                                                                        */
    /*        |                o s                |                                                                           */
    /*        |                                   |                                                                           */
    /*        |              o s                  |                                                                           */
    /*        |          o     s=stackoverflow    |                                                                           */
    /*      5 +      o                            +  5                                                                        */
    /*        |  o                                |                                                                           */
    /*        ---+---------+---------+---------+---                                                                           */
    /*           0         5        10        15                                                                              */
    /*                        XS                                                                                              */
    /*                                                                                                                        */
    /**************************************************************************************************************************/

    /*
     _ __  _ __ ___   ___ ___  ___ ___
    | `_ \| `__/ _ \ / __/ _ \/ __/ __|
    | |_) | | | (_) | (_|  __/\__ \__ \
    | .__/|_|  \___/ \___\___||___/___/
    |_|                      _                        _
     _ __ ___   __ _ _ __   | |_ ___    _   _ _ __ (_) |_  ___  __ _ _   _  __ _ _ __ ___
    | `_ ` _ \ / _` | `_ \  | __/ _ \  | | | | `_ \| | __|/ __|/ _` | | | |/ _` | `__/ _ \
    | | | | | | (_| | |_) | | || (_) | | |_| | | | | | |_ \__ \ (_| | |_| | (_| | | |  __/
    |_| |_| |_|\__,_| .__/   \__\___/   \__,_|_| |_|_|\__||___/\__, |\__,_|\__,_|_|  \___|
                    |_|                                           |_|
    */

    proc sql;
      create
         table mapped as
      select
         xs as xorg
        ,ys as yorg
        ,stackoverflow
        ,(-min(xs)+xs)/(max(xs)-min(xs)) as xs
        ,(-min(ys)+ys)/(max(ys)-min(ys)) as ys
      from
         sd1.have
    ;quit;

    /**************************************************************************************************************************/
    /*                                                                                                                        */
    /* XORG     YORG     STACKOVERFLOW       XS         YS                                                                    */
    /*                                                                                                                        */
    /*   1       5.00         5.000       0.00000    0.00000                                                                  */
    /*   2       7.00         7.000       0.07143    0.01481                                                                  */
    /*   3       9.00         9.000       0.14286    0.02962                                                                  */
    /*   4      11.00        11.000       0.21429    0.04443                                                                  */
    /*   5      13.00        13.000       0.28571    0.05925                                                                  */
    /*   6      15.00        15.000       0.35714    0.07406                                                                  */
    /*   7      28.92        17.000       0.42857    0.17715                                                                  */
    /*   8      42.81        28.922       0.50000    0.28001                                                                  */
    /*   9      56.70        42.810       0.57143    0.38288                                                                  */
    /*  10      70.59        56.698       0.64286    0.48574                                                                  */
    /*  11      84.47        70.586       0.71429    0.58854                                                                  */
    /*  12      98.36        84.474       0.78571    0.69140                                                                  */
    /*  13     112.25        98.362       0.85714    0.79427                                                                  */
    /*  14     126.14       112.250       0.92857    0.89713                                                                  */
    /*  15     140.03       126.138       1.00000    1.00000                                                                  */
    /*                                                                                                                        */
    /**************************************************************************************************************************/

    options ls=64 ps=64;
    proc plot data=mapped;
     plot ys*xs='*'/box ;
    run;quit;
    /*                            _ _
     _ __  _ __ ___   ___   _ __ | (_)_ __
    | `_ \| `__/ _ \ / __| | `_ \| | | `_ \
    | |_) | | | (_) | (__  | | | | | | | | |
    | .__/|_|  \___/ \___| |_| |_|_|_|_| |_|
    |_|
    */

    ods output parameterestimates=est;
    proc nlin data=mapped method=MARQUARDT CONVERGE=0.001;;
      parms A = 1
            B = 1
            ;
      model ys = CDF('BETA', xs, a, b) ;
      output out=results p=predicted r=residual;
    run;quit;

    /*                            _ _                         _ _
     _ __  _ __ ___   ___   _ __ | (_)_ __ ___    _   _ _ __ (_) |_  ___  __ _ _   _  __ _ _ __ ___
    | `_ \| `__/ _ \ / __| | `_ \| | | `_ ` _ \  | | | | `_ \| | __|/ __|/ _` | | | |/ _` | `__/ _ \
    | |_) | | | (_) | (__  | | | | | | | | | | | | |_| | | | | | |_ \__ \ (_| | |_| | (_| | | |  __/
    | .__/|_|  \___/ \___| |_| |_|_|_|_| |_| |_|  \__,_|_| |_|_|\__||___/\__, |\__,_|\__,_|_|  \___|
    |_|                                                                     |_|
    */

    /**************************************************************************************************************************/
    /*                                                                                                                        */
    /*                                                                                                                        */
    /*                                                                                                                        */
    /*                                    Sum of        Mean               Approx                                             */
    /*  Source                    DF     Squares      Square    F Value    Pr > F                                             */
    /*                                                                                                                        */
    /*  Model                      2      3.7588      1.8794    4275.23    <.0001                                             */
    /*  Error                     13     0.00571    0.000440                                                                  */
    /*  Uncorrected Total         15      3.7645                                                                              */
    /*                                                                                                                        */
    /*  XORG     YORG     STACKOVERFLOW       XS         YS      PREDICTED     RESIDUAL                                       */
    /*                                                                                                                        */
    /*    1       5.00         5.000       0.00000    0.00000     0.00000      0.000000                                       */
    /*    2       7.00         7.000       0.07143    0.01481     0.00266      0.012150                                       */
    /*    3       9.00         9.000       0.14286    0.02962     0.01422      0.015400                                       */
    /*    4      11.00        11.000       0.21429    0.04443     0.03753      0.006902                                       */
    /*    5      13.00        13.000       0.28571    0.05925     0.07413     -0.014882                                       */
    /*    6      15.00        15.000       0.35714    0.07406     0.12479     -0.050737                                       */
    /*    7      28.92        17.000       0.42857    0.17715     0.18973     -0.012588                                       */
    /*    8      42.81        28.922       0.50000    0.28001     0.26860      0.011407                                       */
    /*    9      56.70        42.810       0.57143    0.38288     0.36051      0.022368                                       */
    /*   10      70.59        56.698       0.64286    0.48574     0.46392      0.021827                                       */
    /*   11      84.47        70.586       0.71429    0.58854     0.57649      0.012042                                       */
    /*   12      98.36        84.474       0.78571    0.69140     0.69478     -0.003378                                       */
    /*   13     112.25        98.362       0.85714    0.79427     0.81348     -0.019216                                       */
    /*   14     126.14       112.250       0.92857    0.89713     0.92351     -0.026376                                       */
    /*   15     140.03       126.138       1.00000    1.00000     1.00000      0.000000                                       */
    /*                                                                                                                        */
    /*                                                                                                                        */
    /*  Parameter      Estimate                                                                                               */
    /*                                                                                                                        */
    /*  A                2.4478                                                                                               */
    /*  B                1.3775                                                                                               */
    /*                                                                                                                        */
    /*                                                                                                                        */
    /*                                                                                                                        */
    /* options ls=64 ps=44;                                                                                                   */
    /* proc plot data=results(rename=predicted=p12345678901234567890);                                                        */
    /*  plot p12345678901234567890*xs='r' ys*xs='o'/overlay box                                                               */
    /*  haxis=0 to 1 by .25 vaxis=0 to 1 by .25;                                                                              */
    /* run;quit;                                                                                                              */
    /*                                                                                                                        */
    /*       0.00     0.25     0.50     0.75     1.00                                                                         */
    /*      --+--------+--------+--------+--------+---                                                                        */
    /*      |                                        |                                                                        */
    /*    1 +                                     r  +  1                                                                     */
    /*      |                                        |                                                                        */
    /*      |                                  r     |                                                                        */
    /*      |                                  o     |                                                                        */
    /*      |   r=roger                              |                                                                        */
    /*      |   0=observed                           |                                                                        */
    /*      |                                r       |                                                                        */
    /*      |                                o       |                                                                        */
    /*  .75 +                                        + .75                                                                    */
    /*      |                                        |                                                                        */
    /*      |                             r          |                                                                        */
    /*      |                                        |                                                                        */
    /*      |                                        |                                                                        */
    /*      |                           o            |                                                                        */
    /*      |                           r            |                                                                        */
    /*      |                                        |                                                                        */
    /*  .50 +                        o               + .50                                                                    */
    /*      |                        r               |                                                                        */
    /*      |                                        |                                                                        */
    /*      |                                        |                                                                        */
    /*      |                      r                 |                                                                        */
    /*      |                                        |                                                                        */
    /*      |                                        |                                                                        */
    /*      |                   r                    |                                                                        */
    /*  .25 +                                        + .25                                                                    */
    /*      |                                        |                                                                        */
    /*      |                r                       |                                                                        */
    /*      |                                        |                                                                        */
    /*      |              r                         |                                                                        */
    /*      |                                        |                                                                        */
    /*      |           r  o                         |                                                                        */
    /*      |      o  r                              |                                                                        */
    /*    0 + r  r r                                 +  0                                                                     */
    /*      --+--------+--------+--------+--------+---                                                                        */
    /*      0.00     0.25     0.50     0.75     1.00                                                                          */
    /*                  */                                                                                                    */
    /*                                                                                                                        */
    /**************************************************************************************************************************/

    /*                       _                _
     _ __ ___   __ _ _ __   | |__   __ _  ___| | __
    | `_ ` _ \ / _` | `_ \  | `_ \ / _` |/ __| |/ /
    | | | | | | (_| | |_) | | |_) | (_| | (__|   <
    |_| |_| |_|\__,_| .__/  |_.__/ \__,_|\___|_|\_\
                    |_|
    */

    proc sql;
      create
         table mapback as
      select
         stackoverflow
        ,xs*(15 - 1) + 1            as xorg
        ,ys*(140.03 - 5) + 5        as yorg
        ,predicted*(140.03 - 5) + 5 as estorg
      from
         results
    run;quit;

    /**************************************************************************************************************************/
    /*                                                                                                                        */
    /*  STACKOVERFLOW    XORG     YORG      ESTORG                                                                            */
    /*                                                                                                                        */
    /*       5.000         1       5.00      5.000                                                                            */
    /*       7.000         2       7.00      5.359                                                                            */
    /*       9.000         3       9.00      6.920                                                                            */
    /*      11.000         4      11.00     10.068                                                                            */
    /*      13.000         5      13.00     15.009                                                                            */
    /*      15.000         6      15.00     21.851                                                                            */
    /*      17.000         7      28.92     30.620                                                                            */
    /*      28.922         8      42.81     41.270                                                                            */
    /*      42.810         9      56.70     53.680                                                                            */
    /*      56.698        10      70.59     67.643                                                                            */
    /*      70.586        11      84.47     82.844                                                                            */
    /*      84.474        12      98.36     98.816                                                                            */
    /*      98.362        13     112.25    114.845                                                                            */
    /*     112.250        14     126.14    129.702                                                                            */
    /*     126.138        15     140.03    140.030                                                                            */
    /*                                                                                                                        */
    /**************************************************************************************************************************/

    /*                               _
      ___ ___  _ __ ___  _ __  _   _| |_ ___   _ __ ___  ___  ___
     / __/ _ \| `_ ` _ \| `_ \| | | | __/ _ \ | `_ ` _ \/ __|/ _ \
    | (_| (_) | | | | | | |_) | |_| | ||  __/ | | | | | \__ \  __/
     \___\___/|_| |_| |_| .__/ \__,_|\__\___| |_| |_| |_|___/\___|
                        |_|
    */

    data mrg;
     retain mseops mseroger 0;
     if _n_=0 then set sd1.have(drop=ys) nobs=obs;
     merge opsfit mapback;
     mseops=(mseops + (opsfit-yorg)**2)/obs;
     mseroger=(mseroger + (estorg-yorg)**2)/obs;
    run;quit;
    options ls=255;

    /**************************************************************************************************************************/
    /*                                                                                                                        */
    /*                                                                                                                        */
    /*               STACKOVERFLOW   ROGER                           STACKOVERFLOW                    ROGER FIT               */
    /*                 MSEOPS       MSEROGER    XS    STACKOVERFLOW     OPSFIT        XORG     YORG      ESTORG               */
    /*                                                                                                                        */
    /*                 0.0000        0.00000     1         5.000         5.000          1       5.00      5.000               */
    /*                 0.0000        0.17944     2         7.000         7.000          2       7.00      5.359               */
    /*                 0.0000        0.30026     3         9.000         9.000          3       9.00      6.920               */
    /*                 0.0000        0.07792     4        11.000        11.000          4      11.00     10.068               */
    /*                 0.0000        0.27439     5        13.000        13.000          5      13.00     15.009               */
    /*                 0.0000        3.14739     6        15.000        15.000          6      15.00     21.851               */
    /*                 9.4724        0.40243     7        17.000        17.000          7      28.92     30.620               */
    /*                13.4905        0.18500     8        28.922        28.922          8      42.81     41.270               */
    /*                13.7620        0.62048     9        42.810        42.810          9      56.70     53.680               */
    /*                13.7836        0.62045    10        56.698        56.698         10      70.59     67.643               */
    /*                13.7700        0.21764    11        70.586        70.586         11      84.47     82.844               */
    /*                13.7726        0.02838    12        84.474        84.474         12      98.36     98.816               */
    /*                13.7763        0.45075    13        98.362        98.362         13     112.25    114.845               */
    /*                13.7801        0.87571    14       112.250       112.250         14     126.14    129.702               */
    /*                                                                                                                        */
    /*    Final MSE   13.7839        0.05838    15       126.138       126.138         15     140.03    140.030               */
    /*                                                                                                                        */
    /*                                                                                                                        */
    /*                   OUTPUT                                                                                               */                                              */
    /*       REDUCTION FROM 4 to 2 PARAMETERS                                                                                 */                                              */
    /*                                                                                                                        */                                              */
    /*                        XORG                                                                                            */                                              */
    /*          0         5        10        15                                                                               */                                              */
    /*       ---+---------+---------+---------+---                                                                            */                                              */
    /*    Y  | STACKOVERFLOW FIT(S POIINTS)      |                                                                            */                                              */
    /*       | a = 2                             |                                                                            */                                              */
    /*   155 + b = 3                             + 155                                                                        */                                              */
    /*       | c = 13.89                         |                                                                            */                                              */
    /*       | d = -68.3                      r  |                                                                            */                                              */
    /*       | y = a*x+b(x<6)c*x+d               |                                                                            */                                              */
    /*       |                              r    |                                                                            */                                              */
    /*   125 + ROGERS FIT                   o s  + 125                                                                        */                                              */
    /*       | a = 2.4478                        |                                                                            */                                              */
    /*       | b = 1.3775                 r s    |                                                                            */                                              */
    /*       | ys=CDF(BETA,xs,a,b)               |                                                                            */                                              */
    /*       |                          r s      |                                                                            */                                              */
    /*    95 + MSE                               + 95                                                                         */                                              */
    /*       |  ROGER       = 0.05838            |                                                                            */                                              */
    /*       |  STACKOVERFLOW=13.8    r s        |                                                                            */                                              */
    /*       |                                   |                                                                            */                                              */
    /*       |                      o s          |                                                                            */                                              */
    /*    65 +                      r            + 65                                                                         */                                              */
    /*       |                    o s            |                                                                            */                                              */
    /*       |                    r              |                                                                            */                                              */
    /*       |                                   |                                                                            */                                              */
    /*       |                  r s              |                                                                            */                                              */
    /*    35 +                                   + 35                                                                         */                                              */
    /*       |                r s                |                                                                            */                                              */
    /*       |              r                    |                                                                            */                                              */
    /*       |            r o s r=togers fit     |                                                                            */                                              */
    /*       |        o r o     s=stackoverflow  |                                                                            */                                              */
    /*     5 +    r r r         0=observed       +  5                                                                         */                                              */
    /*       |                                   |                                                                            */                                              */
    /*       ---+---------+---------+---------+---                                                                            */                                              */
    /*          0         5        10        15                                                                               */                                              */
    /*                                                                                                                        */                                              */
    /*                       XORG                                                                                             */                                              */
    /*                                                                                                                        */                                              */
    /**************************************************************************************************************************/

    /*             _                   _       _
     ___  ___ _ __(_) ___  ___   _ __ | | ___ | |_
    / __|/ _ \ `__| |/ _ \/ __| | `_ \| |/ _ \| __|
    \__ \  __/ |  | |  __/\__ \ | |_) | | (_) | |_
    |___/\___|_|  |_|\___||___/ | .__/|_|\___/ \__|
                                |_|
    */

    ods listing gpath="d:/png/" style=journal;
    ods graphics / imagename="pltgpgleg" imagefmt=png;

    title "Two Parameter Beta CDF and 4 Parameter Piecewise Linear Fit ";
    proc sgplot data=mrg;
    label  yorg="Original"
           opsfit="Stackoverflow"
           estorg="Roger"
    ;
     series x=xs y=estorg    / lineattrs=(thickness=1pt color=blue);
     series x=xs y=yorg      / lineattrs=(thickness=1pt  color=green);
     series x=xs y=opsfit   / lineattrs=(thickness=1pt color=red);
     inset ( " " ="Stackoverflow fit "
             " " ="a = 2  "
             " " ="b = 3  "
             " " ="c = 13.89  "
             " " ="d = -68.3  "
             " " ="y1 = a*x + b (x<6) y2=c*x + d"
     ) / position=topleft textattrs=( Size=12pt color=red) valuealign=left;
     inset ( " " ="Rogers fit "
             " " ="a = 2.4478 "
             " " ="b = 1.3775 "
             " " ="ys = CDF(BETA, xs, a, b)"
     ) / position=top textattrs=( Size=12pt color=blue) valuealign=left;

    keylegend / location = inside position=left valueattrs=(size=12pt);

    run;quit;
    ods graphics / reset=index imagename="test" imagefmt=png

    /*              _
      ___ _ __   __| |
     / _ \ `_ \ / _` |
    |  __/ | | | (_| |
     \___|_| |_|\__,_|

    */
